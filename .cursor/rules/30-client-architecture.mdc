---
description: Client architecture, screen flow, API layer, and UI components
globs: client/src/**/*.{ts,tsx}
alwaysApply: false
---

# Client Architecture

## Principles

- Phaser handles world rendering and movement only.
- React handles HUD, menus, and task overlays.
- Bridge via Zustand stores, not direct Phaser-React coupling.
- Keep task components self-contained and typed by task definition.
- Never trust client validation for authoritative outcomes.
- **Server is sole source of truth** for inventory, equipment, and currency. Client stores are projections replaced on server messages.

## DOM Roots (`client/index.html`)

- `#game-container` — Phaser canvas (managed by `bootstrap.ts`).
- `#ui-root` — React root (mounted by `main.tsx`).

## Screen Flow (React)

`LoginScreen` -> `RegisterScreen` (toggle) -> `ClassroomPickerScreen` -> `GameScreen`.
`GameScreen` calls `bootGame()` on mount, `destroyGame()` on unmount.

## API Layer (`src/api/`)

- `client.ts` — base fetch wrapper with auth header injection.
- `auth.ts` — login/register calls.
- `classrooms.ts` — list/select classroom calls.

## Data Layer (`src/data/`)

- `itemDefinitions.ts` — loads `content/items/*.item.json` via Vite `import.meta.glob` at build time. `getItemDefinition(id)` for UI lookups.

## Overlay Components (`src/ui/components/`)

- `DialogueBox` — bottom-center NPC dialogue, advances on X/Enter/Space.
- `InventoryPanel` — modal grid (24 slots) toggled by I key. Shows equipment (hand/head), currency wallet, item context menu (right-click for Drop/Equip/etc.).
- `ChestTransferPanel` — read-only container loot preview from server. Claim button sends `ClaimContainer`. Loading state while waiting for `ContainerContents`.
- `Toolbar` — bottom-center hotbar (3 tool slots, keys 1-3).

## Keyboard Shortcuts

WASD (move), X (interact), I (inventory), 1-3 (hotbar), Escape (close panels).
