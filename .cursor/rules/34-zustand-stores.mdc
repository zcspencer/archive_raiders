---
description: Zustand store inventory and Phaser-React bridge pattern
globs: client/src/store/**
alwaysApply: false
---

# Zustand Stores

All stores use `zustand/create`. React subscribes via hooks; Phaser reads via `getState()`.

## Store Index (`client/src/store/`)

| Store | Key State | Purpose |
|-------|-----------|---------|
| `auth` | user session, token | Login/register, localStorage persistence |
| `classroom` | list, selected | Classroom selection before game join |
| `dialogue` | speaker, lines, index | NPC dialogue overlay state |
| `chest` | contents map, open ID | Per-chest inventory, transfer UI |
| `playerControl` | inputMode, hotbarSlot | "game"/"ui" mode, inventory toggle, cursor tile |
| `playerInventory` | item stacks | Player-held items with quantities |
| `gameRoomBridge` | room ref | Colyseus room handle + message senders |

## gameRoomBridge (Phaser-React Bridge)

- Holds the Colyseus `Room` reference set by `useColyseusRoom` hook.
- Exposes: `sendMove(gridX, gridY)`, `sendInteract(payload)`, `sendSelectHotbar(slot)`.
- Phaser systems call these to send messages to server.

## Bridge Data Flow

1. **Phaser -> React**: Phaser systems write to stores (e.g. `dialogueStore.openDialogue()`).
   React components subscribe and render overlays.
2. **React -> Phaser**: `playerControl.inputMode` blocks Phaser input when UI is active.
   `GameplayInput.isBlocked()` reads store state via `getState()`.
3. **Both -> Server**: `gameRoomBridge.sendMove()` / `sendInteract()` relay to Colyseus.
